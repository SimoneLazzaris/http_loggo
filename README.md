# What is this?
It's a simple python script that listen for HTTP POST request generated by fluentbit http output component. Log are then written on a (rotated) logfile for easier consultation and longer storage.
# Why is it useful?
Kubernetes loggin is... erratic. Messages from deleted pod are lost, and only a (small) fraction is kept for running one.
It's also difficult to relate messages from different pods to events or to each other.

Fluentbit makes it easy to collect all messages, but usually requires complex solutions like elasticsearch or graylog. I wanted a simple log file to collect everything and keep it available for a reasonable amount of time.

For that, you could use the syslog output and then rely on the good old rsyslog or syslog-ng, but some details (pod, container, namespace) are lost. 

With this simple script, those details are extracted from the json http payload and stored in the logfile.

# Installation:
To install, you'll have to fix IP address (default is 192.168.100.40) in fluent.yaml.
Then:

```sh
helm repo add fluent https://fluent.github.io/helm-charts
helm install -n fluent --create-namespace fluent fluent/fluent-bit -f fluent.yaml
make install
```
Logfile is /var/log/fluentbit.log; by default, it will keep 20MB of logs, and then it will rotate and 5 rotations will be kept.
